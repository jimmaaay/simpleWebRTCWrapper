/** @preserve simpleWebRTCWrapper https://github.com/jimmaaay/simpleWebRTCWrapper */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.SimpleWebRTCWrapper=t()}(this,function(){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var e,a=(function(e){var o=Object.prototype.hasOwnProperty,h="~";function n(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function r(e,t,n,o,r){if("function"!=typeof n)throw new TypeError("The listener must be a function");var i=new s(n,o||e,r),c=h?h+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],i]:e._events[c].push(i):(e._events[c]=i,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function t(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(h=!1)),t.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(h?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},t.prototype.listeners=function(e){var t=h?h+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,r=n.length,i=new Array(r);o<r;o++)i[o]=n[o].fn;return i},t.prototype.listenerCount=function(e){var t=h?h+e:e,n=this._events[t];return n?n.fn?1:n.length:0},t.prototype.emit=function(e,t,n,o,r,i){var c=h?h+e:e;if(!this._events[c])return!1;var s,u,a=this._events[c],f=arguments.length;if(a.fn){switch(a.once&&this.removeListener(e,a.fn,void 0,!0),f){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,t),!0;case 3:return a.fn.call(a.context,t,n),!0;case 4:return a.fn.call(a.context,t,n,o),!0;case 5:return a.fn.call(a.context,t,n,o,r),!0;case 6:return a.fn.call(a.context,t,n,o,r,i),!0}for(u=1,s=new Array(f-1);u<f;u++)s[u-1]=arguments[u];a.fn.apply(a.context,s)}else{var l,p=a.length;for(u=0;u<p;u++)switch(a[u].once&&this.removeListener(e,a[u].fn,void 0,!0),f){case 1:a[u].fn.call(a[u].context);break;case 2:a[u].fn.call(a[u].context,t);break;case 3:a[u].fn.call(a[u].context,t,n);break;case 4:a[u].fn.call(a[u].context,t,n,o);break;default:if(!s)for(l=1,s=new Array(f-1);l<f;l++)s[l-1]=arguments[l];a[u].fn.apply(a[u].context,s)}}return!0},t.prototype.on=function(e,t,n){return r(this,e,t,n,!1)},t.prototype.once=function(e,t,n){return r(this,e,t,n,!0)},t.prototype.removeListener=function(e,t,n,o){var r=h?h+e:e;if(!this._events[r])return this;if(!t)return a(this,r),this;var i=this._events[r];if(i.fn)i.fn!==t||o&&!i.once||n&&i.context!==n||a(this,r);else{for(var c=0,s=[],u=i.length;c<u;c++)(i[c].fn!==t||o&&!i[c].once||n&&i[c].context!==n)&&s.push(i[c]);s.length?this._events[r]=1===s.length?s[0]:s:a(this,r)}return this},t.prototype.removeAllListeners=function(e){var t;return e?(t=h?h+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},t.prototype.off=t.prototype.removeListener,t.prototype.addListener=t.prototype.on,t.prefixed=h,t.EventEmitter=t,e.exports=t}(e={exports:{}},e.exports),e.exports),f=["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org","stun.services.mozilla.com"],l={optional:[]};return function(e){function i(e){var t,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n=this,t=!(o=c(i).call(this,e))||"object"!=typeof o&&"function"!=typeof o?u(n):o;var r={iceServers:[{url:"stun:"+f[Math.floor(Math.random()*f.length)]}]};return t.dataChannel=!1,t.computer=new RTCPeerConnection(r,{optional:[{DtlsSrtpKeyAgreement:!0}]}),t.computer.addEventListener("datachannel",function(e){console.log(e)}),t.__finishCreatingRoom=t.__finishCreatingRoom.bind(u(u(t))),t}var t,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(i,a),t=i,(n=[{key:"__finishCreatingRoom",value:function(e){var t=JSON.parse(atob(e)),n=new RTCSessionDescription(t);this.computer.setRemoteDescription(n)}},{key:"createRoom",value:function(){var o=this;return new Promise(function(n,e){o.dataChannel=o.computer.createDataChannel("webrtc",{reliable:!0}),o.computer.addEventListener("icecandidate",function(e){if(null==e.candidate){var t=JSON.stringify(o.computer.localDescription.toJSON());n({finishCreatingRoom:o.__finishCreatingRoom,offer:btoa(t)})}}),o.computer.createOffer().then(function(e){return o.computer.setLocalDescription(e)})})}},{key:"joinRoom",value:function(r){var i=this;return new Promise(function(t,n){var e;try{e=JSON.parse(atob(r))}catch(e){return console.log(e),n(e)}var o=new RTCSessionDescription(e);i.computer.setRemoteDescription(o).then(function(e){return i.computer.createAnswer(l).then(function(e){return i.computer.setLocalDescription(e)})}),i.computer.addEventListener("icecandidate",function(e){null==e.candidate&&t(btoa(JSON.stringify(i.computer.localDescription)))})})}}])&&r(t.prototype,n),o&&r(t,o),i}()});
//# sourceMappingURL=simpleWebRTCWrapper.min.js.map
